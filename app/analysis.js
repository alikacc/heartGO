const koefFIRmatlab = [-0.000104429844106665,-6.73496322788656e-05,1.97768368049677e-05,9.26094193605378e-05,9.64538356590293e-05,2.63509764746258e-05,-6.85241140007715e-05,-0.000119921086431384,-9.01759200859261e-05,-5.15034532004543e-07,8.31534761187679e-05,9.75808529156668e-05,2.88208895348704e-05,-7.60622249068285e-05,-0.000141853894033764,-0.000119846317418821,-2.47662044729931e-05,7.38659858903665e-05,0.000101218542628044,3.24480167253399e-05,-8.68668496275319e-05,-0.000171702781274568,-0.000159163388735280,-5.62648832649570e-05,6.21713059926823e-05,0.000106207482131670,3.71837448293063e-05,-0.000100992507567295,-0.000210671981932018,-0.000210830782657131,-9.85002663828270e-05,4.50836513696292e-05,0.000111016451311927,4.28738976516772e-05,-0.000118289328433591,-0.000259625724653805,-0.000277345915478722,-0.000155060288099426,1.92654430877051e-05,0.000113749879896521,4.92452579838085e-05,-0.000138391999274352,-0.000319024461868595,-0.000360892974518991,-0.000229521863508288,-1.89025253937633e-05,0.000112164717084405,5.58940281254972e-05,-0.000160714126374446,-0.000388868653439147,-0.000463239067314474,-0.000325336646229484,-7.32411693555054e-05,0.000103696105939663,6.22765207965216e-05,-0.000184448001427449,-0.000468651386115497,-0.000585636206429859,-0.000445715532005522,-0.000147685957557067,8.54908238217593e-05,6.77022487997106e-05,-0.000208569524617322,-0.000557320707016776,-0.000728731567750905,-0.000593515249408936,-0.000246195459439683,5.44470014006996e-05,7.13294253421748e-05,-0.000231847782851329,-0.000653252059424187,-0.000892488085307718,-0.000771130393238236,-0.000372658929414667,7.25815034863113e-06,7.21626925982034e-05,-0.000252858507324903,-0.000754230623005289,-0.00107611693829245,-0.000980394172028262,-0.000530806640822057,-5.95410005733486e-05,6.90526559340569e-05,-0.000270000334764807,-0.000857442661026756,-0.00127802283095547,-0.00122249095953491,-0.000724127062452213,-0.000149529966294946,6.06965020542699e-05,-0.000281512458608866,-0.000959474133385354,-0.00149576213840170,-0.00149788346509684,-0.000955795389716565,-0.000266363094260896,4.56385994495497e-05,-0.000285491857506317,-0.00105631379322159,-0.00172601294819033,-0.00180625697629380,-0.00122861846219243,-0.000413740036907271,2.22694830752983e-05,-0.000279907790264748,-0.00114335665632071,-0.00196455469594356,-0.00214648268884047,-0.00154500182031571,-0.000595392114649297,-1.11790472083376e-05,-0.000262610583934398,-0.00121540196463488,-0.00220625334790169,-0.00251660163510187,-0.00190694574154876,-0.000815092366930071,-5.66459323937106e-05,-0.000231330806547463,-0.00126663730163865,-0.00244504571011096,-0.00291383016797928,-0.00231607882334682,-0.00107669977544203,-0.000116264572626337,-0.000183663524424435,-0.00129059691984335,-0.00267391307141301,-0.00333458736683993,-0.00277374050700082,-0.00138425233491040,-0.000192404989039303,-0.000117030179371733,-0.00128007684796427,-0.00288482936251279,-0.00377454412349562,-0.00328112865984632,-0.00174213040846926,-0.000287744525883383,-2.86071244736873e-05,-0.00122698060053914,-0.00306866116185375,-0.00422869305652709,-0.00383953637619385,-0.00215532305721285,-0.000405382726572457,8.47959888079967e-05,-0.00112205482906813,-0.00321498402976669,-0.00469143780923931,-0.00445071615045646,-0.00262984935750008,-0.000549025467939562,0.000226934891957328,-0.000954449310156658,-0.00331175765329611,-0.00515669972760650,-0.00511743457878464,-0.00317342105415435,-0.000723280203349339,0.000402451508299717,-0.000710990935124875,-0.00334476287013981,-0.00561803940624805,-0.00584432692886533,-0.00379649630023848,-0.000934135190868828,0.000617395839127999,-0.000374977540570807,-0.00329662956911789,-0.00606879014792061,-0.00663924978481636,-0.00451399667154945,-0.00118975579202360,0.000880094249531263,7.58676782333831e-05,-0.00314513773782333,-0.00650220001854329,-0.00751550971450900,-0.00534820889927453,-0.00150185439767620,0.00120264689256272,0.000672984972409267,-0.00286016520540409,-0.00691157890647843,-0.00849573215166155,-0.00633393325943783,-0.00188816085646224,0.00160364112346999,0.00146358424269404,-0.00239795797894609,-0.00729044682018445,-0.00961902853332776,-0.00752820606954908,-0.00237716094747944,0.00211339788391886,0.00252361659596702,-0.00168967919801188,-0.00763267958809700,-0.0109553877344670,-0.00903018304654670,-0.00301794621527351,0.00278500894689134,0.00398552399026815,-0.000616462786551444,-0.00793264816132616,-0.0126376889953935,-0.0110262526005489,-0.00390299371181894,0.00372030862087500,0.00610488126493576,0.00105180804572538,-0.00818534786299425,-0.0149433047043836,-0.0139079076808748,-0.00522920736327367,0.00514125964497894,0.00944875610333843,0.00383475577857352,-0.00838651417419304,-0.0185467823125256,-0.0186499943376176,-0.00750136250947705,0.00763763889687014,0.0155785008892926,0.00921904529265597,-0.00853272198899407,-0.0255884480759043,-0.0285125161328398,-0.0125122713038188,0.0134548723397079,0.0309188006389084,0.0238931777028960,-0.00862146570026037,-0.0482223393182584,-0.0650368050879952,-0.0346144394757844,0.0458110744432332,0.151875896206210,0.241844087397213,0.277044319097031,0.241844087397213,0.151875896206210,0.0458110744432332,-0.0346144394757844,-0.0650368050879952,-0.0482223393182584,-0.00862146570026037,0.0238931777028960,0.0309188006389084,0.0134548723397079,-0.0125122713038188,-0.0285125161328398,-0.0255884480759043,-0.00853272198899407,0.00921904529265597,0.0155785008892926,0.00763763889687014,-0.00750136250947705,-0.0186499943376176,-0.0185467823125256,-0.00838651417419304,0.00383475577857352,0.00944875610333843,0.00514125964497894,-0.00522920736327367,-0.0139079076808748,-0.0149433047043836,-0.00818534786299425,0.00105180804572538,0.00610488126493576,0.00372030862087500,-0.00390299371181894,-0.0110262526005489,-0.0126376889953935,-0.00793264816132616,-0.000616462786551444,0.00398552399026815,0.00278500894689134,-0.00301794621527351,-0.00903018304654670,-0.0109553877344670,-0.00763267958809700,-0.00168967919801188,0.00252361659596702,0.00211339788391886,-0.00237716094747944,-0.00752820606954908,-0.00961902853332776,-0.00729044682018445,-0.00239795797894609,0.00146358424269404,0.00160364112346999,-0.00188816085646224,-0.00633393325943783,-0.00849573215166155,-0.00691157890647843,-0.00286016520540409,0.000672984972409267,0.00120264689256272,-0.00150185439767620,-0.00534820889927453,-0.00751550971450900,-0.00650220001854329,-0.00314513773782333,7.58676782333831e-05,0.000880094249531263,-0.00118975579202360,-0.00451399667154945,-0.00663924978481636,-0.00606879014792061,-0.00329662956911789,-0.000374977540570807,0.000617395839127999,-0.000934135190868828,-0.00379649630023848,-0.00584432692886533,-0.00561803940624805,-0.00334476287013981,-0.000710990935124875,0.000402451508299717,-0.000723280203349339,-0.00317342105415435,-0.00511743457878464,-0.00515669972760650,-0.00331175765329611,-0.000954449310156658,0.000226934891957328,-0.000549025467939562,-0.00262984935750008,-0.00445071615045646,-0.00469143780923931,-0.00321498402976669,-0.00112205482906813,8.47959888079967e-05,-0.000405382726572457,-0.00215532305721285,-0.00383953637619385,-0.00422869305652709,-0.00306866116185375,-0.00122698060053914,-2.86071244736873e-05,-0.000287744525883383,-0.00174213040846926,-0.00328112865984632,-0.00377454412349562,-0.00288482936251279,-0.00128007684796427,-0.000117030179371733,-0.000192404989039303,-0.00138425233491040,-0.00277374050700082,-0.00333458736683993,-0.00267391307141301,-0.00129059691984335,-0.000183663524424435,-0.000116264572626337,-0.00107669977544203,-0.00231607882334682,-0.00291383016797928,-0.00244504571011096,-0.00126663730163865,-0.000231330806547463,-5.66459323937106e-05,-0.000815092366930071,-0.00190694574154876,-0.00251660163510187,-0.00220625334790169,-0.00121540196463488,-0.000262610583934398,-1.11790472083376e-05,-0.000595392114649297,-0.00154500182031571,-0.00214648268884047,-0.00196455469594356,-0.00114335665632071,-0.000279907790264748,2.22694830752983e-05,-0.000413740036907271,-0.00122861846219243,-0.00180625697629380,-0.00172601294819033,-0.00105631379322159,-0.000285491857506317,4.56385994495497e-05,-0.000266363094260896,-0.000955795389716565,-0.00149788346509684,-0.00149576213840170,-0.000959474133385354,-0.000281512458608866,6.06965020542699e-05,-0.000149529966294946,-0.000724127062452213,-0.00122249095953491,-0.00127802283095547,-0.000857442661026756,-0.000270000334764807,6.90526559340569e-05,-5.95410005733486e-05,-0.000530806640822057,-0.000980394172028262,-0.00107611693829245,-0.000754230623005289,-0.000252858507324903,7.21626925982034e-05,7.25815034863113e-06,-0.000372658929414667,-0.000771130393238236,-0.000892488085307718,-0.000653252059424187,-0.000231847782851329,7.13294253421748e-05,5.44470014006996e-05,-0.000246195459439683,-0.000593515249408936,-0.000728731567750905,-0.000557320707016776,-0.000208569524617322,6.77022487997106e-05,8.54908238217593e-05,-0.000147685957557067,-0.000445715532005522,-0.000585636206429859,-0.000468651386115497,-0.000184448001427449,6.22765207965216e-05,0.000103696105939663,-7.32411693555054e-05,-0.000325336646229484,-0.000463239067314474,-0.000388868653439147,-0.000160714126374446,5.58940281254972e-05,0.000112164717084405,-1.89025253937633e-05,-0.000229521863508288,-0.000360892974518991,-0.000319024461868595,-0.000138391999274352,4.92452579838085e-05,0.000113749879896521,1.92654430877051e-05,-0.000155060288099426,-0.000277345915478722,-0.000259625724653805,-0.000118289328433591,4.28738976516772e-05,0.000111016451311927,4.50836513696292e-05,-9.85002663828270e-05,-0.000210830782657131,-0.000210671981932018,-0.000100992507567295,3.71837448293063e-05,0.000106207482131670,6.21713059926823e-05,-5.62648832649570e-05,-0.000159163388735280,-0.000171702781274568,-8.68668496275319e-05,3.24480167253399e-05,0.000101218542628044,7.38659858903665e-05,-2.47662044729931e-05,-0.000119846317418821,-0.000141853894033764,-7.60622249068285e-05,2.88208895348704e-05,9.75808529156668e-05,8.31534761187679e-05,-5.15034532004543e-07,-9.01759200859261e-05,-0.000119921086431384,-6.85241140007715e-05,2.63509764746258e-05,9.64538356590293e-05,9.26094193605378e-05,1.97768368049677e-05,-6.73496322788656e-05,-0.000104429844106665]

function applyFIRFilter(signal, coeffs) {
    const N = coeffs.length;
    const filtered = new Array(signal.length).fill(0);

    for (let i = 0; i < signal.length; i++) {
        let acc = 0;
        for (let j = 0; j < N; j++) {
            if (i - j >= 0) {
                acc += coeffs[j] * signal[i - j];
            }
        }
        filtered[i] = acc;
    }

    return filtered;
}

function forwardBackwardFIRFilter(signal, coeffs) {
    // Forward pass
    const forward = applyFIRFilter(signal, coeffs);

    // Reverse signal
    const reversed = forward.slice().reverse();

    // Backward filter
    const backward = applyFIRFilter(reversed, coeffs);

    // Reverse again to restore original order
    return backward.reverse();
}

